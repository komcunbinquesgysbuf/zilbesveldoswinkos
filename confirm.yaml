id: confirm
type: PageSiderMenu
properties:
  title: Check data
  _ref: logo.yaml
layout:
  contentGutter: 16
requests:
  - id: db_select
    type: KnexBuilder
    connectionId: database
    properties:
      query:
        - select:
            - data
        - from:
            - confirmation
        - where:
            - id
            - _url_query: r
areas:
  content:
    blocks:
      - id: record_id
        type: Descriptions
        properties:
          column: 1
          bordered: true
          colon: false
          items:
            - label: Your record ID
              value:
                _url_query: r
            - label: Stored data (encrypted)
              value:
                _state: record_data
            - label: Decrypted data (enter key below)
              value:
                _state: message
      - id: secret_key
        type: TextInput
        properties:
          label:
            inline: true
          title: Your secret key
        required: true
        validate:
          - message: Invalid key
            status: error
            pass:
              _regex:
                pattern: ^[a-zA-Z0-9\-_]{22}$
      - id: decrypt_button
        type: Button
        properties:
          icon: UnlockOutlined
          title: Decrypt
        events:
          onClick:
            - id: validate_all
              type: Validate
            - id: decrypt_aes_gcm
              type: JsAction
              params:
                name: aesGcmDecrypt
                args:
                  - _state: record_data
                  - _state: secret_key
            - id: set_decrypted_message
              type: SetState
              params:
                message:
                  _actions: decrypt_aes_gcm.response
events:
  onEnter:
    - id: load_data
      type: Request
      params: db_select
    - id: set_record_data
      type: SetState
      params:
        record_data:
          _get:
            key: 0.0.data
            from:
              _actions: load_data.response
