id: profile
type: PageSiderMenu
properties:
  title: Check data
  _ref: logo.yaml
layout:
  contentGutter: 16
areas:
  header:
    _ref: header.yaml
  content:
    blocks:
      - id: title
        type: Title
        properties: { content: { _nunjucks: { template: 'Welcome back, {{name}}!', on: { name: { _input: name } } } } }
      - id: box
        type: Box
        layout: { span: 12, contentGutter: 16 }
        areas:
          content:
            blocks:
              - id: rcpt.name
                type: TextInput
                properties: { title: Recipient name }
                validate:
                  - message: The name contains disallowed characters.
                    status: error
                    pass: { _regex: { pattern: '^[^"=?<>]*$' } }
              - id: rcpt.mailto
                type: TextInput
                required: true
                properties: { title: Recipient email address }
                validate:
                  - message: Invalid email address.
                    status: error
                    pass: { _regex: { pattern: '^[a-z0-9~!$%\-_+:.\x80-\xff]+@([a-z0-9]+(--?[a-z0-9]+)*\.)+[a-z0-9]+$', flags: i } }
      - id: document
        type: FileReader
        required: true
        layout: { span: 12 }
        properties:
          label: Contract document
#          description: Drop a document here or click to open the file chooser...
#          buttonLabel: Choose…
#          buttonChangeLabel: Choose another…
      - id: fieldsLabel
        type: Label
        properties:
          title: Additional conditions
        areas:
          content:
            blocks:
              - id: fields
                type: ControlledList
                layout: { contentGutter: 16 }
                properties:
                  addItemButton:
                    title: Add condition
                blocks:
                  - id: fields.$.title
                    type: TextInput
                    properties: { placeholder: title, label: { disabled: true } }
                    layout: { span: 8 }
                  - id: fields.$.content
                    type: TextArea
                    properties: { placeholder: content, label: { disabled: true } }
                    layout: { span: 16 }
      - id: submit
        type: Button
        properties: { icon: SendOutlined, title: Submit }
        events:
          onClick:
            - id: extract_mailbox_name
              type: SetState
              params: { mailbox_name: { _string.replace: { on: { _state: rcpt.mailto }, regex: '@.+', newSubstr: '' } } }
            - id: ensure_name
              type: SetState
              params:
                rcpt.name:
                  _if:
                    test: { _eq: [ _if_none: [ _state: rcpt.name, '' ], '' ] }
                    then: { _state: mailbox_name }
                    else: { _state: rcpt.name }
            - id: validate_all
              type: Validate
            - id: convert_document
              type: SetState
              params: { document.raw: { _base64.decode: { _state: document.data } } }
            - id: hash_document
              type: SetState
              params: { document.sha1: { _hash.sha1: { _state: document.raw } } }

events:
  onEnter:
    - id: link_back
      type: Link
      params: { back: true }
      skip: { _not: { _not: { _input: key } } }
